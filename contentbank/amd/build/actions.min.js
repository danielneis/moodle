define ("core_contentbank/actions",["jquery","core/ajax","core/notification","core/str","core/templates","core/url","core/modal_factory","core/modal_events"],function(a,b,c,d,e,f,g,h){var o={DELETE_CONTENT:"[data-action=\"deletecontent\"]",RENAME_CONTENT:"[data-action=\"renamecontent\"]",SET_CONTENT_VISIBILITY:"[data-action=\"setcontentvisibility\"]",RESTORE_CONTENT:"[data-action=\"restorecontent\"]",DELETE_CONTENT_FOREVER:"[data-action=\"deletecontentforever\"]",COPY_CONTENT:"[data-action=\"copycontent\"]"},p=function(){this.registerEvents()};p.prototype.registerEvents=function(){a(o.DELETE_CONTENT).click(function(b){b.preventDefault();var e=a(this).data("contentname"),f=a(this).data("uses"),j=a(this).data("contentid"),k=a(this).data("contextid"),l=a(this).data("folderid"),m="";d.get_strings([{key:"deletecontent",component:"core_contentbank"},{key:"deletecontentconfirm",component:"core_contentbank",param:{name:e}},{key:"deletecontentconfirmlinked",component:"core_contentbank"},{key:"delete",component:"core"}]).then(function(a){var b=a[0],c=a[1];if(0<f){c+=" "+a[2]}m=a[3];return g.create({title:b,body:c,type:g.types.SAVE_CANCEL,large:!0})}).done(function(a){a.setSaveButtonText(m);a.getRoot().on(h.save,function(){return i(j,k,l)});a.getRoot().on(h.hidden,function(){a.destroy()});a.show()}).catch(c.exception)});a(o.RENAME_CONTENT).click(function(b){b.preventDefault();var f=a(this).data("contentname"),i=a(this).data("contentid"),k="";d.get_strings([{key:"renamecontent",component:"core_contentbank"},{key:"rename",component:"core_contentbank"}]).then(function(a){var b=a[0];k=a[1];return g.create({title:b,body:e.render("core_contentbank/renamecontent",{contentid:i,name:f}),type:g.types.SAVE_CANCEL})}).then(function(b){b.setSaveButtonText(k);b.getRoot().on(h.save,function(b){var e=a("#newname").val().trim();if(e){j(i,e)}else{d.get_strings([{key:"error"},{key:"emptynamenotallowed",component:"core_contentbank"}]).then(function(a){c.alert(a[0],a[1])}).catch(c.exception);b.preventDefault()}});b.getRoot().on(h.hidden,function(){b.destroy()});b.show()}).catch(c.exception)});a(o.COPY_CONTENT).click(function(b){b.preventDefault();var f=a(this).data("contentname"),i=a(this).data("contentid"),j="";d.get_strings([{key:"copycontent",component:"core_contentbank"},{key:"copy",component:"moodle"}]).then(function(a){var b=a[0];j=a[1];return g.create({title:b,body:e.render("core_contentbank/copycontent",{contentid:i,name:f}),type:g.types.SAVE_CANCEL})}).then(function(b){b.setSaveButtonText(j);b.getRoot().on(h.save,function(b){var e=a("#newname").val().trim();if(e){k(i,e)}else{d.get_strings([{key:"error"},{key:"emptynamenotallowed",component:"core_contentbank"}]).then(function(a){c.alert(a[0],a[1])}).catch(c.exception);b.preventDefault()}});b.getRoot().on(h.hidden,function(){b.destroy()});b.show()}).catch(c.exception)});a(o.SET_CONTENT_VISIBILITY).click(function(b){b.preventDefault();var c=a(this).data("contentid"),d=a(this).data("visibility");l(c,d)});a(o.DELETE_CONTENT_FOREVER).click(function(b){b.preventDefault();var e=a(this).data("contentname"),f=a(this).data("uses"),i=a(this).data("contentid"),j=a(this).data("contextid"),k="";d.get_strings([{key:"deletecontentforever",component:"core_contentbank"},{key:"deletecontentforeverconfirm",component:"core_contentbank",param:{name:e}},{key:"deletecontentconfirmlinked",component:"core_contentbank"},{key:"delete",component:"core"}]).then(function(a){var b=a[0],c=a[1];if(0<f){c+=" "+a[2]}k=a[3];return g.create({title:b,body:c,type:g.types.SAVE_CANCEL,large:!0})}).done(function(a){a.setSaveButtonText(k);a.getRoot().on(h.save,function(){return m(i,j)});a.getRoot().on(h.hidden,function(){a.destroy()});a.show()}).catch(c.exception)});a(o.RESTORE_CONTENT).click(function(b){b.preventDefault();var e=a(this).data("contentname"),f=a(this).data("contentid"),i=a(this).data("contextid"),j="";d.get_strings([{key:"restorecontent",component:"core_contentbank"},{key:"restorecontentconfirm",component:"core_contentbank",param:{name:e}},{key:"restore",component:"core"}]).then(function(a){var b=a[0],c=a[1];j=a[2];return g.create({title:b,body:c,type:g.types.SAVE_CANCEL,large:!0})}).done(function(a){a.setSaveButtonText(j);a.getRoot().on(h.save,function(){return n(f,i)});a.getRoot().on(h.hidden,function(){a.destroy()});a.show()}).catch(c.exception)})};function i(a,d,e){var g="success";b.call([{methodname:"core_contentbank_delete_content",args:{contentids:{contentid:a}}}])[0].then(function(a){if(a.result){return"contentdeleted"}g="error";return"contentnotdeleted"}).done(function(a){var b={contextid:d,folderid:e};if("success"==g){b.statusmsg=a}else{b.errormsg=a}window.location.href=f.relativeUrl("contentbank/index.php",b,!1)}).fail(c.exception)}function j(a,d){var e="success";b.call([{methodname:"core_contentbank_rename_content",args:{contentid:a,name:d}}])[0].then(function(a){if(a.result){return"contentrenamed"}e="error";return a.warnings[0].message}).then(function(b){var d=null;if("success"==e){d={id:a,statusmsg:b};window.location.href=f.relativeUrl("contentbank/view.php",d,!1)}else{c.addNotification({message:b,type:"error"});c.fetchNotifications()}}).catch(c.exception)}function k(a,d){b.call([{methodname:"core_contentbank_copy_content",args:{contentid:a,name:d}}])[0].then(function(a){if(0==a.id){c.addNotification({message:a.warnings[0].message,type:"error"});c.fetchNotifications();return a.warnings[0].message}else{var b={id:a.id,statusmsg:"contentcopied"};window.location.href=f.relativeUrl("contentbank/view.php",b,!1)}}).catch(c.exception)}function l(a,d){var e="success";b.call([{methodname:"core_contentbank_set_content_visibility",args:{contentid:a,visibility:d}}])[0].then(function(a){if(a.result){return"contentvisibilitychanged"}e="error";return a.warnings[0].message}).then(function(b){var d=null;if("success"==e){d={id:a,statusmsg:b};window.location.href=f.relativeUrl("contentbank/view.php",d,!1)}else{c.addNotification({message:b,type:"error"});c.fetchNotifications()}}).catch(c.exception)}function m(a,d){var e="success";b.call([{methodname:"core_contentbank_delete_content_forever",args:{contentids:{contentid:a}}}])[0].then(function(a){if(a.result){return"contentdeleted"}e="error";return"contentnotdeleted"}).done(function(a){var b={contextid:d};if("success"==e){b.statusmsg=a}else{b.errormsg=a}window.location.href=f.relativeUrl("contentbank/trash.php",b,!1)}).fail(c.exception)}function n(a){var d="success";b.call([{methodname:"core_contentbank_restore_content",args:{contentids:{contentid:a}}}])[0].then(function(a){if(a.result){return"contentrestored"}d="error";return"contentnotrestored"}).done(function(b){var c={id:a};if("success"==d){c.statusmsg=b}else{c.errormsg=b}window.location.href=f.relativeUrl("contentbank/view.php",c,!1)}).fail(c.exception)}return{init:function init(){return new p}}});
//# sourceMappingURL=actions.min.js.map
