define(["jquery","core/ajax","core/custom_interaction_events","core/notification","mod_forum/repository","mod_forum/selectors"],function(a,b,c,d,e,f){var g=function(a){var b=a.prev(f.post.post);if(b.length){var c=b.find(f.post.post).last();c.length?c.focus():b.focus()}else a.parents(f.post.post).first().focus()},h=function(b){var c=b.find(f.post.post).first();if(c.length)c.focus();else{var d=b.next(f.post.post);d.length?d.focus():b.parents().toArray().forEach(function(b){var c=a(b).next(f.post.post);if(c.length)return void c.focus()})}},i=function(b){var c=a(b).closest(f.post.inpageReplyContent);return!!c.length},j=function(b){var d=b.find(f.post.post);d.each(function(b,c){var d=a(c).find(f.post.action),e=d.first();d.attr("tabindex","-1"),e.attr("tabindex",0)}),c.define(b,[c.events.up,c.events.down,c.events.next,c.events.previous,c.events.home,c.events.end]),b.on(c.events.up,function(c,d){var e=document.activeElement;if(!i(e)){var h=a(e).closest(f.post.post);h.length?g(h):b.find(f.post.post).first().focus(),d.originalEvent.preventDefault()}}),b.on(c.events.down,function(c,d){var e=document.activeElement;if(!i(e)){var g=a(e).closest(f.post.post);g.length?h(g):b.find(f.post.post).first().focus(),d.originalEvent.preventDefault()}}),b.on(c.events.home,function(a,c){i(document.activeElement)||(b.find(f.post.post).first().focus(),c.originalEvent.preventDefault())}),b.on(c.events.end,function(a,c){i(document.activeElement)||(b.find(f.post.post).last().focus(),c.originalEvent.preventDefault())}),b.on(c.events.next,f.post.action,function(b,c){var d=a(b.target),e=d.closest(f.post.actionsContainer),g=e.find(f.post.action),h=d.next(f.post.action);g.attr("tabindex","-1"),h.length||(h=g.first()),h.attr("tabindex",0),h.focus(),c.originalEvent.preventDefault()}),b.on(c.events.previous,f.post.action,function(b,c){var d=a(b.target),e=d.closest(f.post.actionsContainer),g=e.find(f.post.action),h=d.prev(f.post.action);g.attr("tabindex","-1"),h.length||(h=g.last()),h.attr("tabindex",0),h.focus(),c.originalEvent.preventDefault()}),b.on(c.events.home,f.post.action,function(b,c){var d=a(b.target),e=d.closest(f.post.actionsContainer),g=e.find(f.post.action),h=g.first();g.attr("tabindex","-1"),h.attr("tabindex",0),h.focus(),b.stopPropagation(),c.originalEvent.preventDefault()}),b.on(c.events.end,f.post.action,function(b,c){var d=a(b.target),e=d.closest(f.post.actionsContainer),g=e.find(f.post.action),h=g.last();g.attr("tabindex","-1"),h.attr("tabindex",0),h.focus(),b.stopPropagation(),c.originalEvent.preventDefault()})},k=function(){a('[data-container="discussion-tools"]').on("click",f.subscription.toggle,function(b,c){var f=a(this),g=f.data("forumid"),h=f.data("discussionid"),i=f.data("targetstate");e.setDiscussionSubscriptionState(g,h,i).then(function(){1==i?(a("[data-targetstate=0]").removeClass("hidden"),a("[data-targetstate=1]").addClass("hidden")):(a("[data-targetstate=1]").removeClass("hidden"),a("[data-targetstate=0]").addClass("hidden"))})["catch"](d.exception),b.preventDefault(),c.originalEvent.preventDefault()})};return{init:function(a){j(a),k()}}});